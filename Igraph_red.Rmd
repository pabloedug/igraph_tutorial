---
title: "MEDIDAS DE RED"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(igraph)
library(igraphdata)
knitr::opts_chunk$set(echo = FALSE)
data(kite)
data(enron)
```


## INTRODUCCION

### Medidas de red 

Además de conocer cómo se comportan en la red los individuos (cual es su posición e importancia, mediante las medidas de centralidad), es muchas veces necesario conocer el comportamiento y estructura de la red en su conjunto.

### Resumen de medidas

Existen distintos tipos de medidas de red, basadas en:

* **distancia**: cómo de cerca o lejos se encuentran los miembros de la red.  

* **conectividad**: cómo de conectados en su conjunto.  

* **estructura**: cómo se organizan las relaciones.

## DISTANCIA

Entre las medidas de distancia, se encuentran las siguientes:

* **diámetro**, que es la longitud del camino mínimo más largo de la red.

* **distancia media**, que es la distancia media a la que están los pares de nodos entre sí.

Vamos a volver a trabajar, en primer lugar, con el grafo de *kite*:

```{r echo=FALSE}
plot(kite)
```

*Modifica el siguiente código para responder a las cuestiones de más abajo*:

```{r distance-kite, exercise=TRUE, exercise.eval=TRUE}
kite
```

```{r distance-kite-hint}
diameter(,normalized = FALSE)
mean_distance()
```


```{r distance-kite-quiz}
quiz(caption = "",
  question(allow_retry = TRUE,"¿Cual es el diámetro del grafo?",
    answer("4", correct = TRUE),
    answer("5"),
    answer("6")
  ),
  question(allow_retry = TRUE,"¿Cual es la distancia media?",
    answer("1,98", correct = TRUE),
    answer("1,23"),
    answer("2,39")
  )
)
```

*Vamos a hacer ahora lo propio con el grafo de Enron*:

```{r distance-enron, exercise=TRUE, exercise.eval=TRUE}
enron
```

```{r distance-enron-quiz}
quiz(caption = "",
  question(allow_retry = TRUE,"¿Cual es el diámetro del grafo?",
    answer("4"),
    answer("5"),
    answer("6", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Cual es la distancia media?",
    answer("1,98"),
    answer("1,23"),
    answer("2,39", correct = TRUE)
  )
)
```


## CONECTIVIDAD

Las medidas de conectividad son aquellas que permiten entender cómo de conectada está la red en su conjunto. Destacamos aquí tres medidas:

* **densidad**: se trata del número de enlaces existentes, dividido por el número de enlaces posibles.

* **grado medio & grado máximo**: puede serlo del grado de entrada o de salida, si se trata de una red dirigida.

* **reciprocidad**: en redes dirigidas, esta es una medida que permite conocer en qué proporción las conexiones son recíprocas.

A continuación, vamos a trabajar con el grafo de Enron, que es un grafo dirigido.

En primer lugar, vamos a ilustrar un procesamiento que debemos hacer del grafo de Enron, muy habitual en todos aquellos grafos en que existen múltiples enlaces.

En el grafo original, cada vez que un nodo se relaciona con otro nodo, se crea el enlace correspondiente (en el caso de Enron, tenemos un total de `r format(gsize(enron),big.mark   = ".")` enlaces entre los `r gorder(enron)` nodos).

Veamos por ejemplo a continuación los enlaces de salida (emails enviados) y de entrada (emails recibidos) que tiene el nodo 1.

```{r connectivity-enron-raw-node1-out, echo=TRUE}
adjacent_vertices(enron, 1, mode = c("out"))
```

```{r connectivity-enron-raw-node1-in, echo=TRUE}
adjacent_vertices(enron, 1, mode = c("in"))
```

Lo que nos suele interesar es que el enlace entre cada par de nodos sea único, y crear un atributo del enlace (por ejemplo el peso) que permita capturar el número de veces que se produce. Para ello utilizamos la siguiente función:

```{r connectivity-enron-simplify, echo=TRUE}
E(enron)$weight <- 1
enron_simplified <- simplify(enron)
```

Ahora el grafo de Enron ha pasado a tener `r format(gsize(enron_simplified),big.mark   = ".")` enlaces entre los `r gorder(enron_simplified)` nodos. Vamos a volver a ver los enlaces salientes y entrantes del nodo 1, que ahora tienen mucho más sentido:

```{r connectivity-enron-simplified-node1-out, echo=TRUE}
adjacent_vertices(enron_simplified, 1, mode = c("out"))
```

```{r connectivity-enron-simplified-node1-in, echo=TRUE}
adjacent_vertices(enron_simplified, 1, mode = c("in"))
```

*Modifica el siguiente código para responder a las cuestiones de más abajo. Vamos a trabajar con el grafo de Enron simplificado*:

```{r connectivity-enron, exercise=TRUE, exercise.eval=TRUE}
enron_simplified
```

```{r connectivity-enron-hint}
edge_density()
mean()
max()
degree(mode = )
```


```{r betweenness-centrality-quiz}
quiz(caption = "",
  question(allow_retry = TRUE,"¿Cual es la densidad del grafo?",
    answer("0.09", correct = TRUE),
    answer("0.11"),
    answer("0.21")
  ),
  question(allow_retry = TRUE,"¿Cual es el grado promedio de salida?",
    answer("16.36", correct = TRUE),
    answer("8,49"),
    answer("30,04")
  ),
  question(allow_retry = TRUE,"¿Cual es el grado promedio de entrada?",
    answer("16.36", correct = TRUE),
    answer("8,49"),
    answer("30,04")
  ),
  question(allow_retry = TRUE,"¿Cual es el grado máximo de salida?",
    answer("30"),
    answer("60"),
    answer("100", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Cual es el grado máximo de entrada?",
    answer("30"),
    answer("60", correct = TRUE),
    answer("100")
  ),
  question(allow_retry = TRUE,"¿Cual es la reciprocidad de la red?",
    answer("0.21"),
    answer("0.61", correct = TRUE),
    answer("0.82")
  )
)
```


## ESTRUCTURA

coeficiente de clustering, componentes, etc. distribución de grado

Si consideramos las distancias geodésicas (esto es, las distancias de los caminos mínimos) de un nodo al resto de nodos de la red, la suma de estas es una medida de cuán lejos está del conjunto. Por ello, el valor inverso de esta suma es la medida de cercanía.

La medida normalizada es la resultante de multiplicarla por *n*-1 (siendo *n* el número de nodos). Así, el máximo de cercanía sería de 1, lo que equivale estar a un paso del resto de la red.


```{r echo=FALSE}
data(kite)
plot(kite)
```

*Modifica el siguiente código para responder a las cuestiones de más abajo*:

```{r closeness-centrality, exercise=TRUE, exercise.eval=TRUE}
kite
```

```{r closeness-centrality-hint}
closeness(,normalized = FALSE)
sort(,decreasing = TRUE)
```


```{r closeness-centrality-quiz}
quiz(caption = "",
  question(allow_retry = TRUE,"¿Quién tiene la mayor intermediación?",
    answer("F"),
    answer("G"),
    answer("Las dos anteriores son correctas", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Qué valor toma ese máximo si se normaliza?",
    answer("0.39"),
    answer("0,49"),
    answer("0,64", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Qué valor tomaría la cercanía normalizada del hub -o nodo central- en un grafo de estrella?",
    answer("0"),
    answer("1", correct = TRUE),
    answer("Depende del número de nodos")
  )
)
```

## COMPARATIVA

Una vez hemos practicado con los conceptos y cálculo de grado, intermediación y cercanía, vamos a reflexionar sobre algunas de sus diferencias. En el grafo siguiente, con el que estamos trabajando, se han destacado en verde, rojo y azul, los nodos que obtienen puntuaciones máximas, respectivamente, en <span style="color:green;">grado<span/>, <span style="color:red;">intermediación<span/> y <span style="color:blue;">cercanía<span/>.

```{r echo=FALSE}
data(kite)
grado <- degree(graph = kite)
intermediacion <- betweenness(graph = kite)
cercania <- closeness(graph = kite)
color <- rep(NA, vcount(kite))
color[grado==max(grado)] <- "green"
color[intermediacion==max(intermediacion)] <- "red"
color[cercania==max(cercania)] <- "blue"
plot(kite,vertex.color=color)
```

*Responde a las siguientes preguntas sobre las diferencias entre estas tres medidas de centralidad:*

```{r centrality-measures-comparison-quiz}
quiz(caption = "",
  question(allow_retry = TRUE,"¿Qué medida/s tiene/n en cuenta la estructura global de la red?",
    answer("grado"),
    answer("intermediación", correct = TRUE),
    answer("cercanía", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Qué medida/s admite/n que nodos con pocos contactos directos aparezcan destacados?",
    answer("grado"),
    answer("intermediación", correct = TRUE),
    answer("cercanía", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Qué medida/s admite/n normalización de las puntuaciones originales?",
    answer("grado", correct = TRUE),
    answer("intermediación", correct = TRUE),
    answer("cercanía", correct = TRUE)
  ),
  question(allow_retry = TRUE,"¿Qué medida/s admite/n variaciones en función de si la red es o no dirigida?",
    answer("grado", correct = TRUE),
    answer("intermediación", correct = TRUE),
    answer("cercanía", correct = TRUE)
  )
)
```

